function initControls(){stage.addEventListener("stagemousedown",onMouseDown),stage.addEventListener("stagemouseup",onMouseUp),stage.addEventListener("stagemousemove",onMouseMove),stage.addEventListener("touchstart",onTouchStart)}function onMouseDown(o){currPoint=map.globalToLocal(o.stageX,o.stageY),currCoord=pointToCoord(currPoint),currTile=getTile(currCoord.q,currCoord.r),0===o.nativeEvent.button&&(drawing=!0,getTile(currCoord.q,currCoord.r)||getPlate(currCoord.q,currCoord.r)||(connectionPath=[JSON.stringify(currCoord)]),console.log(pointToCoord(currPoint))),2===o.nativeEvent.button&&(dragging=!0,dragOrigin={x:o.stageX-map.x*cam.scaleX,y:o.stageY-map.y*cam.scaleY})}function onMouseMove(o){currPoint=map.globalToLocal(o.stageX,o.stageY),currCoord=pointToCoord(currPoint),currTile=getTile(currCoord.q,currCoord.r),drawing&&_.each(pathFind(prevCoord,currCoord),function(o){_.contains(connectionPath,JSON.stringify({q:o.q,r:o.r}))||getTile(o.q,o.r)||getPlate(o.q,o.r)||(console.log(_.map(neighbours({q:o.q,r:o.r}),function(o){return getPlate(o)})),connectionPath.push(JSON.stringify({q:o.q,r:o.r})))}),dragging&&(map.x=(o.stageX-dragOrigin.x)/cam.scaleX,map.y=(o.stageY-dragOrigin.y)/cam.scaleY),JSON.stringify(prevCoord)!=JSON.stringify(currCoord)&&(map.removeChild(pointerTile),currTile||new PointerTile(currCoord.q,currCoord.r)),prevCoord=currCoord,prevPoint=currPoint}function onMouseUp(o){0===o.nativeEvent.button&&(drawing=!1,connectionPath=_.map(connectionPath,function(o){return JSON.parse(o)}),_.each(connectionPath,function(o){console.log(o)}),server.createConnection(connectionPath),console.log(JSON.stringify(connectionPath))),2===o.nativeEvent.button&&(dragging=!1)}function onTouchStart(){map.x=0,map.y=0}var drawing=dragging=!1,dragOrigin,currTile,currPoint,currCoord,prevCoord,prevPoint,connectionPath,pointerTile,lastCoord;